---
tags: [ai, 基础概念, 中级]
---

# AI Agent 核心概念体系（中级）

> [!info] 学习目标
> 系统掌握 **Prompt → Agent → MCP → SubAgent → Skills → Agent Teams** 六大核心概念，理解它们之间的关系和使用场景。

---

## 🧠 一、核心概念全景图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        AI Agent 能力体系                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   用户需求（自然语言）                                                    │
│        │                                                                 │
│        ▼                                                                 │
│   ┌─────────┐                                                            │
│   │ Prompt  │  ←── 输入层：告诉 AI 要做什么                               │
│   └────┬────┘                                                            │
│        │                                                                 │
│        ▼                                                                 │
│   ┌─────────┐     ┌─────────┐     ┌─────────┐                           │
│   │  Agent  │────▶│   MCP   │────▶│ 外部工具 │  ←── 执行层               │
│   │ (智能体) │     │ (协议)   │     │ 文件/API │                           │
│   └────┬────┘     └─────────┘     └─────────┘                           │
│        │                                                                 │
│        ├──────────┬──────────┬──────────┐                               │
│        ▼          ▼          ▼          ▼                               │
│   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                       │
│   │SubAgent │ │ Skills  │ │  Hooks  │ │ Agent   │  ←── 扩展层           │
│   │ (子代理) │ │ (技能)   │ │ (钩子)   │ │ Teams   │                       │
│   └─────────┘ └─────────┘ └─────────┘ └─────────┘                       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📚 二、六大核心概念详解

### 1. Prompt（提示词）

> **🍳 通俗比喻**：Prompt 就像给厨师看的**菜谱**——告诉 AI 你想吃什么、有什么忌口、喜欢什么口味。

**定义**：给 AI 的输入指令，定义对话内容、角色和行为准则

**核心类型**：

| 类型 | 作用 | 比喻 | 示例 |
|------|------|------|------|
| **System Prompt** | 定义角色、人设、行为准则 | 演员的角色卡 | "你是一个专业的代码审查专家..." |
| **User Prompt** | 用户的实际输入 | 观众的问题 | "帮我优化这段代码" |

**💡 进阶理解**：
- Prompt 是整个 AI 系统的**入口**
- 好的 Prompt = 清晰的意图 + 具体的约束 + 验证标准
- 2025年趋势：从"提示词工程"进化到"上下文工程"

---

### 2. Agent（智能体）

> **🤖 通俗比喻**：Agent 就像一个**全能管家**——不只是会说话，还能动手干活（调用工具、执行操作）。

**定义**：能调用工具的 AI 系统，从"只会说"变成"能说能做"

**核心特征**：
```
Agent = LLM（大脑）+ Tools（工具）+ Orchestration（编排）
```

**Agent vs 普通聊天 AI**：

| 维度 | 普通聊天 AI | Agent |
|------|-------------|-------|
| 能力 | 只会说话 | 能调用工具、执行操作 |
| 输出 | 纯文本 | 文件、命令、API调用 |
| 自主性 | 被动回答 | 主动规划、执行、验证 |
| 记忆 | 对话上下文 | 可访问文件系统、数据库 |

**💡 进阶理解**：
- Agent 的核心是 **"行动能力"**，不只是理解
- Agent 会经历 "感知 → 规划 → 执行 → 反思" 的循环
- 2025年是 "Agentic AI" 元年——AI 从助手变成队友

---

### 3. MCP（Model Context Protocol）

> **🔌 通俗比喻**：MCP 就像 **USB 接口**——不管什么设备（数据库、API、文件系统），只要支持 MCP，就能即插即用。

**定义**：Agent 与外部工具/数据源之间的**标准化通信协议**（Anthropic 2024年11月推出）

**为什么需要 MCP？**
```
传统方式：每个 AI 应用 × 每个数据源 = N×M 种定制开发（噩梦）
MCP 方式：一次开发，所有 MCP 兼容的 AI 都能用
```

**三层架构**：

```
┌─────────────────────────────────────────────────┐
│                 MCP Host（主机）                 │
│        Claude Desktop / Claude Code / IDE       │
│              接收用户指令，驱动 Agent             │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│               MCP Client（客户端）               │
│           与 Server 建立会话，能力协商            │
│              将请求转为 JSON-RPC 格式            │
└─────────────────────┬───────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────┐
│               MCP Server（服务器）               │
│     文件系统 / 数据库 / GitHub / Slack / ...    │
│          封装外部能力，暴露为标准化 Tool          │
└─────────────────────────────────────────────────┘
```

**MCP Server 提供的三类能力**：

| 类型 | 作用 | 示例 |
|------|------|------|
| **Tools** | 可执行的函数/操作 | 读取文件、发送消息、查询数据库 |
| **Resources** | 可访问的数据源 | 文件内容、数据库记录、API响应 |
| **Prompts** | 预定义的提示词模板 | 常用任务的标准指令 |

**💡 进阶理解**：
- 2025年3月 OpenAI 宣布兼容 MCP，随后 Google、微软跟进
- MCP 已成为 **跨厂商通用标准**
- 类比：MCP 是 AI 时代的"USB-C"，一次封装，全球可用

---

### 4. SubAgent（子代理）

> **👔 通俗比喻**：SubAgent 就像**老板派活给专业员工**——老板（主Agent）只看结果，员工（SubAgent）在自己的办公室（独立上下文）里干活。

**定义**：拥有**完全独立上下文**的专用执行单元，由主 Agent 派发任务并独立完成

**核心价值**：
- 🔒 **上下文隔离**：SubAgent 的中间过程不污染主 Agent 的上下文
- ⚡ **并行处理**：多个 SubAgent 可同时处理不同任务
- 🎯 **专业分工**：每个 SubAgent 专注做一件事

**SubAgent vs Agent 对比**：

| 维度 | Agent | SubAgent |
|------|-------|----------|
| **上下文** | 共享主上下文 | **完全独立**的上下文空间 |
| **执行方式** | 串行，在主推理流程中展开 | 可并行，独立推理循环 |
| **工具调用** | 通过主 Agent 间接调用 | 可配置专属工具集（白名单/黑名单） |
| **适合任务** | 分析、审查、简单线性任务 | 开发、重构、代码探索等复杂多步骤任务 |
| **资源消耗** | 中等 | 较高（额外协调开销） |
| **Token 成本** | 低 | 较高（独立上下文需要额外 token） |

**工作原理图**：

```
┌─────────────────────────────────────────────────────────────┐
│                      SUBAGENT 模式                           │
│  ┌──────────────┐                                           │
│  │   主Agent     │ ← 只接收精简结果                          │
│  │  (指挥官)     │                                          │
│  └──────┬───────┘                                           │
│         │ 派发任务                                           │
│    ┌────┴────┬──────────┐                                   │
│    ↓         ↓          ↓                                   │
│ ┌──────┐ ┌──────┐ ┌──────┐                                  │
│ │SubA-1│ │SubA-2│ │SubA-3│  ← 各自独立上下文                 │
│ │代码  │ │测试  │ │文档  │                                  │
│ │探索  │ │生成  │ │编写  │                                  │
│ └──┬───┘ └──┬───┘ └──┬───┘                                  │
│    ↓         ↓          ↓                                   │
│  结果1     结果2      结果3  → 精简摘要返回主Agent            │
└─────────────────────────────────────────────────────────────┘
```

**💡 进阶理解**：
- SubAgent 适合需要"深度思考"的任务（代码探索、大规模重构）
- 主 Agent 的上下文是稀缺资源，SubAgent 是"上下文管理"策略
- 可配置更便宜的模型（如 Haiku）来控成本

---

### 5. Skills（技能）

> **📖 通俗比喻**：Skills 就像**培训手册**——给 Agent 一份"怎么做某事"的详细指南，它照着做就行了。

**定义**：包含指令、脚本和资源的**文件夹**，教导 Agent 如何完成特定任务（Anthropic 2025年10月发布）

**核心特点**：
- 🔄 **自动触发**：Agent 根据用户意图自动判断何时使用
- 📦 **渐进式加载**：启动时只加载名称和描述，需要时才加载完整内容
- 🔀 **跨平台兼容**：Claude.ai、Claude Code、API 都能用

**Skills 的三层架构**（渐进式展示）：

| 层级 | 内容 | 加载时机 | Token 消耗 |
|------|------|----------|------------|
| **第一层** | Metadata（name + description） | 始终在上下文中 | ~100词 |
| **第二层** | SKILL.md 主体指令 | 技能触发后加载 | <5000词 |
| **第三层** | scripts/、references/、assets/ | 按需加载 | 无限制 |

**Skills 文件结构**：
```
my-skill/
├── SKILL.md          # 必填：技能说明（包含 YAML 元数据）
├── FORMS.md          # 可选：表单填写指南
├── REFERENCE.md      # 可选：API 文档
└── scripts/
    └── example.py    # 可选：辅助脚本
```

**SKILL.md 示例**：
```markdown
---
name: code-reviewer
description: 专业的代码审查专家。当用户请求代码审查、检查代码质量时自动触发。
allowed-tools: Read, Grep, Bash
---

# Code Reviewer

## 职责
- 检查代码是否符合规范
- 查找潜在 bug 和安全漏洞
- 提供优化建议

## 工作流程
1. 读取目标文件
2. 使用工具分析代码结构
3. 输出审查报告（Critical / Warning / Suggestion）
```

**💡 进阶理解**：
- Skills 是"内化能力"——把知识直接塞进 Agent 脑子里
- 与 SubAgent 的区别：Skills 共享上下文，SubAgent 独立上下文
- 适合：需要推理和专业知识指导的任务

---

### 6. Agent Teams（智能体团队）

> **👥 通俗比喻**：Agent Teams 就像一个**真正的团队**——产品经理、架构师、工程师、测试各司其职，可以互相讨论、协作、投票决策。

**定义**：多个独立 Agent 组成的协作网络，支持 Agent 之间直接通信、共享任务列表、自组织工作流

**Agent Teams vs SubAgents 核心区别**：

| 维度 | SubAgents | Agent Teams |
|------|-----------|-------------|
| **会话模式** | 单会话内委派 | **跨多个独立会话**协作 |
| **通信拓扑** | 星型汇报（只向主Agent汇报） | **队员可直接互聊** |
| **协调机制** | 主Agent统一调度 | **共享任务列表，自协作** |
| **并行能力** | 顺序派发 | **真正并行执行** |
| **Token 成本** | 较高 | **最高**（可能是单Agent的10倍+） |

**使用场景对比**：

| 场景 | 推荐方案 | 原因 |
|------|----------|------|
| 调试5个独立bug | Agent Teams | 真正并行，1小时搞定 |
| 重构模块并写测试 | SubAgent | 需要独立上下文隔离 |
| 代码审查 | Agent | 线性任务，不需要隔离 |
| 复杂系统设计 | Agent Teams | 需要多角色讨论协作 |

**💡 进阶理解**：
- Agent Teams 是"多智能体协作"的高级形态
- 成本最高，仅用于高价值复杂任务
- 核心：Agent 之间可以**直接对话**，而不是都通过主 Agent 中转

---

## 📊 三、概念对比总表

### 选择决策树

```
你的任务需要什么？
│
├── 只需要 AI 理解意图并回答
│   └── 用 Prompt（普通对话）
│
├── 需要AI执行操作（读写文件、调用API）
│   └── 用 Agent + MCP
│
├── 任务复杂，需要隔离上下文
│   ├── 单一复杂任务（代码探索、重构）
│   │   └── 用 SubAgent
│   │
│   └── 多个独立任务需要并行
│       ├── 任务之间不需要协作
│       │   └── 用多个 SubAgent
│       │
│       └── 任务之间需要协作讨论
│           └── 用 Agent Teams（成本最高）
│
└── 需要给 Agent 添加专业知识
    └── 用 Skills
```

### 六大概念对比总表

| 概念 | 核心作用 | 上下文 | 成本 | 适用场景 |
|------|----------|--------|------|----------|
| **Prompt** | 输入指令 | - | 最低 | 所有场景的入口 |
| **Agent** | 执行操作的智能体 | 共享 | 中等 | 需要工具调用的任务 |
| **MCP** | 工具连接协议 | - | - | 连接外部数据/工具 |
| **SubAgent** | 独立上下文的子代理 | **独立** | 较高 | 复杂多步骤任务 |
| **Skills** | 专业知识/工作流 | 共享 | 低 | 特定领域的任务指导 |
| **Agent Teams** | 多Agent协作网络 | 各自独立 | **最高** | 需要多角色协作的复杂任务 |

### 从简原则

> **⚠️ 黄金法则**：能用简单的就不用复杂的
>
> **Agent → SubAgent → Agent Teams**
>
> 成本递增，复杂度递增，只在必要时升级

---

## 🔄 四、协作关系图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        实际工作流示例                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  用户："帮我重构登录模块，并写测试，最后审查代码"                      │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      主 Agent                                │    │
│  │  1. 理解需求，制定计划                                        │    │
│  │  2. 调用 Skills：加载"重构最佳实践"技能                        │    │
│  │  3. 派发 SubAgent-1：重构登录模块（独立上下文）                 │    │
│  │  4. 派发 SubAgent-2：编写测试用例（独立上下文）                 │    │
│  │  5. 通过 MCP 调用：运行测试、读取代码                           │    │
│  │  6. 整合结果，输出最终报告                                     │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                      │
│  涉及概念：                                                          │
│  ✓ Prompt（用户输入）                                                │
│  ✓ Agent（主控智能体）                                               │
│  ✓ Skills（重构知识）                                                │
│  ✓ SubAgent（独立执行单元）                                          │
│  ✓ MCP（工具调用协议）                                               │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## ❓ 五、常见问题

### Q1: Skills 和 SubAgent 有什么区别？什么时候用哪个？

**核心区别**：
- **Skills**：共享上下文，是"内化能力"（把知识塞进 Agent 脑子）
- **SubAgent**：独立上下文，是"外包能力"（派活给别人干）

**选择指南**：
| 场景 | 推荐 |
|------|------|
| 自动格式化、命名检查、轻量任务 | ✅ Skills |
| 代码审查、重构、性能分析 | ✅ SubAgent |
| 需要并行处理多个复杂任务 | ✅ 多个 SubAgent |
| 快速共享能力给团队 | ✅ Skills 打包成 Plugin |

### Q2: 什么时候该用 Agent Teams？

**判断标准**：
1. 任务是否需要**多个专业角色**协作？（如产品经理+架构师+工程师）
2. Agent 之间是否需要**直接对话讨论**？
3. 任务价值是否足够高，值得 10 倍 Token 成本？

如果三个问题都是 YES，才考虑 Agent Teams。

### Q3: MCP 和传统 API 有什么区别？

| 对比 | 传统 API | MCP |
|------|----------|-----|
| 接口格式 | 各自定义 | **统一标准** |
| 一次开发 | 只能一个应用用 | 所有 MCP 兼容应用都能用 |
| 维护成本 | 高（N×M 种对接） | 低（一次封装） |
| 比喻 | 各种专用接口 | USB-C（通用接口） |

### Q4: 如何选择工具权限（allowed-tools）？

**SubAgent 常用工具配置**：

| 任务类型 | 推荐工具 |
|----------|----------|
| 代码审查 | Read, Grep, Glob |
| 代码修改 | Read, Edit, Write, Bash |
| 测试运行 | Read, Bash |
| 文档生成 | Read, Write, Glob |

---

## 🔗 六、相关文档

- [[01-基础概念/Skills 是什么]]
- [[03-进阶应用/Claude MCP 使用指南]]
- [[04-高级应用/Claude Subagent 使用指南]]

---

## 📚 参考资料

- [Anthropic Claude Code 官方文档](https://code.claude.com/docs)
- [MCP 官方规范](https://modelcontextprotocol.io)
- [Claude Code 进阶秘籍](https://post.m.smzdm.com/p/a5027qgk/)
- [Anthropic Skills GitHub](https://github.com/anthropics/skills)
