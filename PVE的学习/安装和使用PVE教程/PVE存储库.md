---
tags: [pve]
---

# PVE 存储库详解

> [!info] 概述
> PVE 中有两种"存储库"：Storage（存储虚拟机磁盘、ISO、备份）和 Repository（软件更新源）。
> 类比：Storage 是"仓库"，存虚拟机的东西；Repository 是"供货商"，提供系统更新。

## 核心概念 💡
- **Storage（存储库）**：放 VM 磁盘/ISO/备份的"仓库"
- **Repository（更新存储库）**：系统和组件的更新源（APT 软件源）
- **内容类型限制**：每个存储库有特定的用途限制

## PVE 里的"两种存储库"

| 名字 | 中文常被叫 | 实际作用 |
|------|-----------|----------|
| Storage | 存储库 | 放 VM 磁盘/ISO/备份 |
| Repository | 更新存储库 | 系统和组件的更新源 |

## 更新存储库（Repository）

### 是什么？

> **PVE 去哪里下载系统更新、补丁、内核、Web 界面、QEMU、LXC 等软件**

本质就是 **APT 软件源**。

### 你在「更新 → 存储库」里看到的都是什么？

#### 1. `pve-enterprise`

- 🔒 官方企业源
- ❌ **需要订阅**
- 没订阅就会报错/弹提示

📌 **个人/学习环境不该用**

#### 2. `pve-no-subscription` ⭐⭐⭐

- ✅ 免费
- ✅ 官方提供
- ❗ 更新略微激进（但稳定）

📌 **个人玩家/家用/实验环境首选**

#### 3. `ceph` 相关源（如果你没用 Ceph）

- ❌ 可以禁用
- 否则更新会报错

#### 4. Debian 官方源

- `bookworm`
- `security`
- `updates`

👉 **PVE 本质是 Debian + PVE 组件**

### 更新存储库配置不当的后果

- 更新失败
- `apt update` 报错
- Web UI 一直提示订阅错误

📌 **但不会影响虚拟机运行**，只是你没法升级系统

## 存储库（Storage）

### 一句话定义

> **PVE 的"存储库（Storage）"= 用来放虚拟机和容器"所有东西的仓库"**

只要是 **虚拟机/容器/ISO/备份**，**99% 都是从存储库里来、放回存储库里去。**

### 存储库里放什么？

你可以把它理解成一个**带权限和用途标签的硬盘池**。

| 类型 | 说明 |
|------|------|
| ISO 镜像 | 系统安装盘（iStoreOS、Ubuntu 等） |
| VM 磁盘 | 虚拟机真正的"硬盘" |
| CT 磁盘 | LXC 容器的文件系统 |
| 备份 | vzdump 生成的 `.zst` |
| Snippets | cloud-init/脚本 |
| 模板 | 容器模板 |

### 为什么 PVE 要搞"存储库"？

因为 PVE 要解决 3 件事：

#### ① 统一管理（这是核心）

不管你用的是：
- 本地 SSD
- 机械盘
- NAS
- iSCSI
- NFS
- ZFS

👉 **在 PVE 眼里，全都叫 Storage**

#### ② 控制"能干嘛"（非常重要）

每个存储库都有 **内容类型限制**：

| 存储库 | ISO | Backup | VM Disk | CT Disk |
|--------|-----|--------|---------|---------|
| local | ✅ | ✅ | ✅ | ✅ |
| local-lvm | ❌ | ❌ | ✅ | ✅ |

👉 **不是所有盘都能放所有东西**

#### ③ 为迁移/备份/高可用服务

- VM 迁移
- 在线备份
- 多节点集群

全都依赖 **存储库抽象**

## 默认存储库

### `local`

👉 本质：`/var/lib/vz`，普通目录

👉 常用来：
- ISO
- 备份
- 模板
- Snippets

📌 **适合放小文件，不适合放虚拟机磁盘（性能一般）**

### `local-lvm`

👉 本质：LVM Thin Pool，块存储

👉 常用来：
- VM 磁盘
- 容器磁盘

📌 **不能存 ISO/备份**，但性能好

### 存储库对比

| 存储库名称 | 类型 | 用途 | 能存内容 |
|------------|------|------|----------|
| local | 普通目录 | ISO、备份、模板 | ISO、Backup、Snippets |
| local-lvm | LVM Thin Pool | VM 磁盘、容器磁盘 | VM Disk、CT Disk |

## 存储库 ≠ 一块硬盘

一个存储库可以是：
- 一块硬盘的一部分
- 一个目录
- 一个网络挂载
- 一个逻辑池

👉 **你是在"用存储"，不是"用盘"**

## 什么时候需要"新建存储库"？

| 场景 | 说明 |
|------|------|
| 加了一块新盘 | 需要创建新的存储库来使用 |
| 挂了 NAS | 添加 NFS/CIFS 存储库 |
| 想把备份单独放 | 创建专用备份存储库 |
| 想做快照/ZFS | ZFS 存储库支持快照 |
| VM 太多想分流 | 分散存储压力 |

## 创建 iStoreOS 虚拟机的例子

你在创建 iStoreOS 虚拟机时：

**1️⃣ ISO 从哪里选？**

👉 **Storage: local**

**2️⃣ 硬盘放哪里？**

👉 **Storage: local-lvm**

这就是为什么你**创建 VM 时要选两次存储**。

## 注意事项 ⚠️

1. **local-lvm 不能存 ISO**：只能存虚拟机磁盘
2. **local 性能一般**：不适合高性能虚拟机
3. **存储库可以多种类型**：目录、LVM、ZFS、NFS、CIFS 等
4. **内容类型是硬限制**：不能在 local-lvm 上存 ISO
5. **删除存储库要小心**：上面的数据会一起删除

## 常见问题 ❓

**Q: Storage 和 Repository 有什么区别？**
A: Storage 存虚拟机数据（磁盘、ISO），Repository 存系统软件（更新包）。

**Q: local 和 local-lvm 哪个好？**
A: 各有用途：local 放小文件，local-lvm 放虚拟机磁盘。

**Q: 什么时候需要新建存储库？**
A: 加新硬盘、挂 NAS、想单独放备份、使用 ZFS 时。

**Q: 可以把 VM 从 local-lvm 移到 local 吗？**
A: 可以，但性能会下降。建议移动到专门的存储库。

**Q: 怎么查看存储库使用情况？**
A: 在 PVE Web 界面的 Datacenter → Storage 可以看到每个存储库的使用情况。

## 相关文档

[[安装和使用PVE]] | [[PVE的基础优化设置]] | [[如何创建PVE虚拟机]] | [[PVE学习笔记MOC]]
