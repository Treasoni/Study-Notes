---
tags: [pve]
---

# PVE 容器（CT/LXC）详解

> [!info] 概述
> CT（Container）是基于 LXC 技术的系统级容器，与虚拟机相比共享宿主机内核，性能接近裸机。
> 类比：就像"没有自己操作系统内核的虚拟机"，更轻量、更快、更省资源。

## 核心概念 💡
- **LXC**：Linux Containers，Linux 容器技术
- **CT**：Container 的缩写，PVE 中对 LXC 容器的称呼
- **共享内核**：CT 和宿主机共用同一个 Linux 内核
- **用户态隔离**：CT 有独立的文件系统、用户、服务

## CT 到底是什么？

在 PVE 里：

> **CT = 基于 LXC 的系统级容器**

它不是虚拟机，但它：
- 有自己的：
  - root 文件系统
  - `/etc`
  - `/usr`
  - 用户、服务、systemd
- 可以：
  - `apt install`
  - 开机自启
  - `systemctl start ssh`
  - 当一台"完整 Linux"用

👉 **CT 的本质：和宿主机共用内核，但用户态完全隔离**

## CT vs 虚拟机（VM）

| 对比项 | VM | CT |
|--------|-----|-----|
| 内核 | 每台一个 | 共用宿主机内核 |
| 启动速度 | 慢（几十秒） | 快（1-3 秒） |
| 资源占用 | 高 | 非常低 |
| 系统完整度 | 100% | 95%（足够用） |
| 性能 | 有虚拟化损耗 | 接近裸机 |
| 内存占用 | 固定分配 | 按需分配 |

👉 **CT 是"没有内核的虚拟机"**

这也是为什么：
- CT **性能好**
- CT **启动快**
- CT **非常省内存**

## CT vs Docker（重点）

### 抽象层级不同（这是本质）

```
硬件
 └─ 宿主机 Linux 内核
     ├─ CT（完整 Linux 用户态）
     │   ├─ systemd
     │   ├─ ssh
     │   └─ 多个服务
     └─ Docker
         └─ 单个应用进程
```

### 对比一张核心表

| 维度 | CT（LXC） | Docker |
|------|-----------|--------|
| 抽象层 | 系统级 | 应用级 |
| 是否有 systemd | ✅ 有 | ❌ 无 |
| 是否像一台服务器 | ✅ 是 | ❌ 否 |
| 运维方式 | apt/systemctl | 镜像/容器 |
| 适合长期运行 | 非常适合 | 适合 |
| 学习成本 | 中 | 低 |
| 可控性 | 非常高 | 相对低 |

### 如何选择？

| 场景 | 推荐 | 原因 |
|------|------|------|
| 旁路由、软路由 | CT | 需要完整网络配置 |
| NAS 服务 | CT | 需要多个服务协同 |
| Home Assistant | CT | 官方支持 CT |
| Docker 宿主 | CT | Docker in CT 是常见做法 |
| 单个应用 | Docker | 更简单轻量 |

## 在 PVE 里，CT 能干什么？

你可以在 CT 里：
- 跑一个完整系统：Debian/Ubuntu/Alpine/Arch
- 干这些事：
  - 当旁路由
  - 当 NAS 服务节点
  - 当 Home Assistant Supervisor
  - 跑 Docker（Docker in CT）
  - 跑数据库、MQTT、Node.js、Java 服务

> [!tip] 关键点
> CT 不是"只能跑一个程序"，它是**一个系统**

## CT 的特点

### 性能

- **接近裸机**：几乎没有虚拟化损耗
- **IO 性能优秀**：直接使用宿主机文件系统

### 启动速度

- **1-3 秒**启动完成
- 比 VM 快几十倍

### 资源占用

- **内存按需分配**：不占用固定内存
- **磁盘空间小**：几百 MB 到几 GB
- **CPU 共享**：没有虚拟化损耗

### 适合场景

| 场景 | 说明 |
|------|------|
| 旁路由 | OpenWrt、iStoreOS 等 |
| NAS 服务 | Samba、NFS、FTP 等 |
| Home Assistant | 智能家居中枢 |
| Docker 宿主 | 运行多个 Docker 容器 |
| 开发环境 | 代码编译、测试 |
| 轻量级服务 | Web 服务器、数据库等 |

## 操作步骤

### 1. 下载 CT 模板

1. 打开 PVE Web 界面
2. 选择节点 → CT Templates
3. 选择模板，点击下载
4. 常用选择：
   - **Debian 12 (Bookworm)**：稳定、通用，PVE 9 官方支持
   - **Ubuntu 24.04/22.04**：新手友好，社区活跃
   - **Alpine**：极简、极小（几 MB）

### 2. 创建 CT 容器

1. 点击 `Create CT`
2. 配置基本参数：
   - **VM ID**：容器编号
   - **Hostname**：主机名
   - **Password**：root 密码
3. 选择模板：使用下载的模板
4. 配置资源：
   - **CPU**：核心数
   - **Memory**：内存大小
   - **Swap**：交换空间
5. 配置存储：
   - **Storage**：选择存储库
   - **Disk size**：磁盘大小
6. 配置网络：
   - **IPv4/CIDR**：静态 IP 或 DHCP
   - **Gateway**：网关地址

### 3. 启动和管理

1. 启动 CT：点击 `Start`
2. 进入控制台：点击 `Console`
3. 安装软件：`apt install` 或 `apt update`
4. 设置开机自启：CT 默认开机自启

## 注意事项 ⚠️

1. **CT 只能跑 Linux**
   - 不能跑 Windows
   - 不同 Linux 发行版都可以

2. **共享宿主机内核**
   - 内核版本受宿主机限制
   - 需要特殊内核模块的要注意

3. **网络配置**
   - 默认使用网桥（vmbr0）
   - 可以独立 IP 或共享 IP

4. **权限和资源限制**
   - 可以限制 CPU、内存、磁盘 IO
   - 默认没有限制

## 常见问题 ❓

**Q: CT 和 VM 哪个好？**
A: 各有用途：CT 更轻量更快，适合 Linux 服务；VM 更完整，适合不同系统和需要独立内核的场景。

**Q: CT 能跑 Windows 吗？**
A: 不能，CT 只能跑 Linux。跑 Windows 需要用 VM。

**Q: CT 里可以再跑 Docker 吗？**
A: 可以，Docker in CT 是常见做法。需要特殊配置，但完全可行。

**Q: CT 的性能真的接近裸机吗？**
A: 是的，因为几乎没有虚拟化损耗，只差在用户态隔离的轻微开销。

**Q: 如何选择 CT 还是 Docker？**
A: 需要完整系统用 CT，只跑单个应用用 Docker。也可以在 CT 里跑 Docker。

**Q: CT 可以做 GPU 直通吗？**
A: 可以，但有限制。通常用于 GPU 计算，不是图形输出。

## 相关文档

[[如何创建PVE虚拟机]] | [[PVE存储库]] | [[PVE的网络逻辑讲解]] | [[安装和使用PVE]] | [[PVE学习笔记MOC]]
