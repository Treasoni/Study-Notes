---
tags: [pve]
---

# PVE 虚拟机创建完整教程

> [!info] 概述
> 创建虚拟机（VM）是给一台"假电脑"分配硬件资源、接好网络、准备装系统的过程。
> 类比：就像组装一台电脑，需要选择 CPU、内存、硬盘、网卡等组件，然后安装操作系统。

## 核心概念 💡
- **虚拟机（VM）**：完整的虚拟电脑，有独立的操作系统和内核
- **BIOS/UEFI**：虚拟机的启动方式，SeaBIOS（老）vs OVMF/UEFI（新）
- **EFI Disk**：UEFI 启动必须的启动配置盘
- **机型**：q35（新）vs i440fx（老）
- **CPU 类型**：host 模式性能最好
- **VirtIO SCSI**：虚拟磁盘控制器，性能最优

## 创建虚拟机本质在做什么？

> **创建虚拟机 = 给一台"假电脑"分配硬件资源 + 接好网络 + 准备装系统**

这台"假电脑"会有：

| 真实电脑 | 虚拟机 |
|---------|--------|
| 主板 | 虚拟主板 |
| CPU | vCPU |
| 内存 | 虚拟内存 |
| 硬盘 | 虚拟磁盘 |
| 网卡 | 虚拟网卡 |
| U 盘/光驱 | ISO |

## 操作步骤

### 1. 常规配置

点击 `Create VM` 后首先看到：

| 配置项 | 说明 | 建议 |
|--------|------|------|
| **VM ID** | 虚拟机编号，全局唯一 | 自动分配或手动指定 |
| **名称** | 虚拟机名称，方便识别 | 使用有意义的名称 |

### 2. OS（操作系统）

核心问题：**这台虚拟机是"怎么启动的"？**

#### 常见选择

**✔ Use CD/DVD disc image file (iso)**
- 用 ISO 装系统（Linux/Windows）
- 最常用的方式

**✔ Do not use any media**
- iStoreOS/OpenWRT 常用
- 稍后手动导入磁盘

#### ISO 文件从哪来？

👉 **PVE 的存储库（local）里**
`Datacenter → Storage → local → ISO Images`

> [!tip] 如何添加 ISO
> 上传 ISO 到 `local` 存储库的 `ISO Images` 目录

### 3. System（系统）

这里是很多人第一次会懵的地方。

#### 3.1 BIOS

| 选项 | 适用场景 |
|------|----------|
| **SeaBIOS** | 老系统、简单场景 |
| **OVMF (UEFI)** | **现代系统推荐** |

👉 **Linux/Windows 10+/iStoreOS → UEFI**

##### SeaBIOS vs UEFI 对比

| 对比点 | SeaBIOS | UEFI |
|--------|---------|------|
| 启动时代 | 老 | 新 |
| 磁盘分区 | MBR | GPT |
| EFI 分区 | 不需要 | **必须** |
| 大于 2TB | ❌ | ✅ |
| Secure Boot | ❌ | 可选 |
| 现代系统 | 勉强 | **原生** |
| PVE 推荐 | ❌ | **✅** |

##### EFI Disk 是干嘛的？（重点！）

> **EFI Disk = UEFI 的"启动配置盘"**

它不是系统盘，它不装你的 Linux，它只存：
- 启动项
- NVRAM 变量
- bootloader 路径

**类比（非常重要）**

现实电脑：
- 主板里有一块 **NVRAM**
- 专门存启动顺序、EFI 启动项

👇
**虚拟机没有主板**
👇
PVE 就用 **EFI Disk 来模拟这块区域**

##### 如果没有 EFI Disk 会怎样？

你会看到报错：
```
WARN: no efidisk configured! Using temporary efivars disk.
```

**含义**：
> "你选了 UEFI，但没给我 EFI Disk
> 我只能临时凑一个
> 重启可能丢启动信息"

**结果**：
- 装完系统
- 重启进不去
- 找不到启动项

##### EFI Disk 配置

| 项目 | 推荐 |
|------|------|
| Storage | local-lvm |
| Format | raw |
| Size | 默认（几 MB） |
| Secure Boot | ❌ 关闭（除非知道在干嘛） |

##### 如何取消 Secure Boot

1. 在虚拟机的 **引导顺序** 中
2. 把 net0（网络启动）放第一位
3. 开机进入 BIOS
4. 关闭安全启动
5. 关机
6. 把引导盘放回第一位

#### 3.2 机型

| 机型 | 说明 | 推荐 |
|------|------|------|
| **q35** | 新一代，支持 PCIe | **推荐** |
| i440fx | 老一代，兼容性好 | 老系统 |

👉 **i440fx**：不支持最新的 PCIe 或一些 NVMe，但兼容性最好
👉 **q35**：支持一些新的设备

#### 3.3 SCSI Controller

👉 **VirtIO SCSI**

| 控制器类型 | 性能 |
|-----------|------|
| VirtIO SCSI | **最好**（推荐） |
| LSI Logic | 中等 |
| IDE | 差（不推荐） |

### 4. 磁盘

#### 4.1 ISO 格式（常见）

1. 在 `OS` 步骤选择 ISO
2. 在 `Hard Disk` 步骤设置磁盘大小
3. 选择存储库：`local-lvm`

#### 4.2 IMG 格式（特殊）

有些系统（如 iStoreOS）提供 IMG 镜像：

1. `操作系统` 选择**不使用任何介质**
2. 删除默认磁盘
3. 用命令导入 IMG 文件
4. 在 `硬件` → `硬盘` 中会看到导入的磁盘

### 5. CPU

| 配置项 | 说明 | 建议 |
|------|------|------|
| 插槽 | CPU 数量 | 通常 1 |
| 核心 | CPU 核心数 | 根据需求分配 |
| 类别 | CPU 类型 | **host**（推荐） |
| vCPU | 线程数 | 可选 |

**CPU 类别选择**：
- **host**：性能最好，暴露宿主机 CPU 特性
- **kvm64**：兼容模式
- **qemu64**：最兼容但性能最差

### 6. 内存

| 配置项 | 说明 | 建议 |
|------|------|------|
| 最小内存 | 保证分配的内存 | 根据系统需求 |
| ballooning | 内存气球设备 | 可开启 |

### 7. 网络

| 配置项 | 说明 | 建议 |
|------|------|------|
| 型号 | VirtIO/E1000/Realtek | **VirtIO** |
| 网桥 | vmbr0/vmbr1/... | 根据网络配置 |
| 防火墙 | 是否启用防火墙 | 按需 |
| VLAN | VLAN 标签 | 按需 |

**网卡型号**：
- **VirtIO**：性能最优（半虚拟化）
- E1000：Intel e1000 模拟（兼容好）
- Realtek：不推荐

### 8. 确认并创建

检查所有配置，点击 `Finish` 完成创建。

## 注意事项 ⚠️

1. **UEFI 必须有 EFI Disk**
   - 没有会无法启动
   - 大小几 MB 即可

2. **CPU 类型用 host**
   - 性能最好
   - 暴露宿主机 CPU 特性

3. **VirtIO 驱动**
   - Linux 原生支持
   - Windows 需要安装 [[PVE创建window]]

4. **磁盘选择**
   - 虚拟机磁盘用 `local-lvm`
   - ISO 用 `local`

5. **机型选择**
   - 新系统用 q35
   - 老系统用 i440fx

## 常见问题 ❓

**Q: SeaBIOS 和 UEFI 选哪个？**
A: 新系统选 UEFI（OVMF），老系统选 SeaBIOS。不确定选 UEFI。

**Q: EFI Disk 是系统盘吗？**
A: 不是，EFI Disk 只是启动配置盘，几 MB 就够。系统盘要另外创建。

**Q: CPU 类型 host 安全吗？**
A: 家庭环境没问题。生产环境可能需要考虑隔离。

**Q: VirtIO 和 E1000 哪个好？**
A: VirtIO 性能最好，需要驱动；E1000 兼容性好但性能差。

**Q: 内存 ballooning 是什么？**
A: 内存动态分配技术，允许 VM 使用超过分配的内存。

**Q: 如何修改已创建 VM 的配置？**
A: 选中 VM → Hardware → 可以添加/删除设备，部分配置需要关机。

## 相关文档

[[PVE创建window]] | [[PVE存储库]] | [[PVE的网络逻辑讲解]] | [[安装和使用PVE]] | [[PVE学习笔记MOC]]
