# 1. HTTP / SOCKS ä»£ç†ï¼ˆå¼ºçƒˆæ¨èï¼‰

é€‚åˆï¼š

- æ‹‰é•œåƒ
- API
- Web åº”ç”¨
- LunaTV / NASTools / åˆ®å‰Š

## 1.1 å®¿ä¸»æœºå·²ç»æœ‰ä»£ç†ï¼ˆå¦‚ Clashï¼‰

å‡è®¾ä»£ç†åœ°å€æ˜¯ï¼š

`å®¿ä¸»æœºIP:7890`

Docker Composeï¼š

```bash
services:
  app:
    image: xxx
    environment:
      - HTTP_PROXY=http://192.168.1.10:7890
      - HTTPS_PROXY=http://192.168.1.10:7890
      - ALL_PROXY=socks5://192.168.1.10:7891

```

âš  æ³¨æ„ï¼š

- **ä¸èƒ½ç”¨ 127.0.0.1**
- è¦ç”¨å®¿ä¸»æœºçœŸå® IP

## 1.2 éªŒè¯æ˜¯å¦æˆåŠŸ

```bash
sudo docker exec -it app bash curl https://google.com
```

èƒ½é€š âœ”
# 2. ä»€ä¹ˆæ—¶å€™ã€ä¸éœ€è¦ã€‘è´¦å·å¯†ç ï¼ˆæœ€å¸¸è§ï¼‰

## 2.1  Clash é»˜è®¤æƒ…å†µ

- Clash / Clash Meta
- èŠ‚ç‚¹æ¥è‡ªè®¢é˜…
- æœ¬åœ°ç›‘å¬ç«¯å£ï¼š
    - HTTPï¼š`7890`
    - SOCKS5ï¼š`7891`

ğŸ‘‰ **é»˜è®¤ï¼šæ²¡æœ‰è´¦å·å¯†ç **

ä½ ç›´æ¥ç”¨å°±è¡Œï¼š

```bash
environment:
  - HTTP_PROXY=http://å®¿ä¸»æœºIP:7890
  - HTTPS_PROXY=http://å®¿ä¸»æœºIP:7890
  - ALL_PROXY=socks5://å®¿ä¸»æœºIP:7891
```

âœ” ä¸ç”¨å¡«ä»»ä½•ç”¨æˆ·åå¯†ç   
âœ” Docker å®¹å™¨ã€curlã€apt éƒ½èƒ½ç”¨

## 2.2 å¦‚ä½•å¿«é€Ÿç¡®è®¤ã€Œæœ‰æ²¡æœ‰é‰´æƒã€

åœ¨å®¿ä¸»æœºæ‰§è¡Œï¼š
```bash
curl -x http://127.0.0.1:7890 https://www.google.com -I
```

- **èƒ½è¿”å› HTTP 200 / 301 / 302**  
    ğŸ‘‰ æ²¡æœ‰è´¦å·å¯†ç 
- **è¿”å› 407 Proxy Authentication Required**  
    ğŸ‘‰ æœ‰è´¦å·å¯†ç  â—


## 2.3 ä»€ä¹ˆæ—¶å€™ã€éœ€è¦ã€‘è´¦å·å¯†ç ï¼Ÿ

### 2.3.1 ä½ è‡ªå·±åœ¨ Clash é‡Œ**ä¸»åŠ¨å¼€äº†é‰´æƒ**

æ¯”å¦‚é…ç½®é‡Œæœ‰ï¼š

```yaml
authentication:
  - "user1:pass1"
```

æˆ–è€…ï¼š
```yaml
users:
  user1: pass1
```

ğŸ‘‰ é‚£å°±å¿…é¡»å¡«è´¦å·å¯†ç 

å¦‚ä½•çœ‹è´¦å·å¯†ç [å¦‚ä½•æŸ¥çœ‹è´¦å·å¯†ç ï¼Ÿ](../å¤–ç½‘å¦‚ä½•ä½¿ç”¨ä»£ç†è¿›è¡Œç¿»å¢™.md#å¦‚ä½•æŸ¥çœ‹è´¦å·å¯†ç ï¼Ÿ)
## 2.4 å¦‚æœéœ€è¦è´¦å·å¯†ç ï¼Œæ€ä¹ˆå†™ï¼Ÿ

### 2.4.1 HTTP / HTTPS ä»£ç†å†™æ³•

æ ¼å¼ğŸ‘‡

`http://ç”¨æˆ·å:å¯†ç @IP:ç«¯å£`

Docker Compose ç¤ºä¾‹ï¼š

```bash
environment:
  - HTTP_PROXY=http://user1:pass1@192.168.1.10:7890
  - HTTPS_PROXY=http://user1:pass1@192.168.1.10:7890
```


### 2.4.2 SOCKS5 ä»£ç†å†™æ³•

`socks5://ç”¨æˆ·å:å¯†ç @IP:ç«¯å£`

```bash
environment:
  - ALL_PROXY=socks5://user1:pass1@192.168.1.10:7891
```

# 3. HTTP ä»£ç† vs SOCKS5 ä»£ç†ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å…ˆç»™ä½ ä¸€ä¸ªé€‰å‹ç»“è®º**

> **Docker å®¹å™¨é‡Œï¼šä¼˜å…ˆç”¨ HTTP / HTTPS ä»£ç†**  
> SOCKS5ï¼šåªæœ‰åœ¨ä½ æ˜ç¡®çŸ¥é“â€œè¿™ä¸ªç¨‹åºæ”¯æŒ SOCKS5â€æ—¶å†ç”¨


## 3.1 æœ¬è´¨åŒºåˆ«

|å¯¹æ¯”ç‚¹|HTTP ä»£ç†|SOCKS5 ä»£ç†|
|---|---|---|
|å·¥ä½œå±‚çº§|åº”ç”¨å±‚ï¼ˆHTTPï¼‰|ä¼ è¾“å±‚ï¼ˆTCP/UDPï¼‰|
|æ˜¯å¦æ‡‚åè®®|**æ‡‚ HTTP / HTTPS**|**ä¸å…³å¿ƒæ˜¯ä»€ä¹ˆåè®®**|
|æ”¯æŒèŒƒå›´|HTTP / HTTPS|**å‡ ä¹æ‰€æœ‰ TCP**|
|Docker å‹å¥½åº¦|â­â­â­â­â­|â­â­|
|å¸¸è§ç«¯å£|7890|7891|


## 3.2 HTTP ä»£ç†æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

HTTP ä»£ç†åªå¹²ä¸€ä»¶äº‹ï¼š

> **â€œå¸®ä½ è½¬å‘ HTTP / HTTPS è¯·æ±‚â€**

æµç¨‹ï¼š

```
å®¹å™¨ç¨‹åº â†’ HTTP è¯·æ±‚ â†’ HTTP ä»£ç† â†’ ç›®æ ‡ç½‘ç«™
```

å®ƒèƒ½åšçš„äº‹ï¼š

- è¯†åˆ« URL
- å¤„ç† HTTPS CONNECT
- è‡ªåŠ¨é€‚é… curl / apt / wget / npm / pip
- Docker å®˜æ–¹å°±æ”¯æŒå®ƒ

ğŸ‘‰ æ‰€ä»¥ **æå…¶ç¨³å®š**

**å…¸å‹ Docker ä½¿ç”¨åœºæ™¯ï¼ˆå¼ºçƒˆæ¨èï¼‰**

- æ‹‰ GitHub
- è®¿é—® TMDB / TheMovieDB
- æ‹‰ API
- Web æœåŠ¡

`HTTP_PROXY=http://å®¿ä¸»æœºIP:7890 HTTPS_PROXY=http://å®¿ä¸»æœºIP:7890`

## 3.3 SOCKS5 æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

SOCKS5 æ˜¯ï¼š

> **â€œæˆ‘ä¸ç®¡ä½ æ˜¯ä»€ä¹ˆåè®®ï¼Œåªè´Ÿè´£æŠŠ TCP æµé‡è½¬å‡ºå»â€**

æµç¨‹ï¼š

`å®¹å™¨ç¨‹åº â†’ TCP æ•°æ® â†’ SOCKS5 â†’ å¤–ç½‘`

å®ƒçš„ç‰¹ç‚¹ï¼š

âœ” é€šç”¨  
âœ” æ”¯æŒé HTTPï¼ˆå¦‚ BTã€FTPï¼‰  
âŒ **ç¨‹åºå¿…é¡»æ˜ç¡®æ”¯æŒ SOCKS5**


## 3.4  ä¸€å¼ â€œäººè¯ç†è§£å›¾â€
```text
HTTPä»£ç†ï¼š
â€œä½ è¦è®¿é—®è¿™ä¸ªç½‘é¡µï¼Ÿæˆ‘æ‡‚ï¼Œæˆ‘å¸®ä½ å‘â€

SOCKS5ï¼š
â€œä½ ç»™æˆ‘ä¸€å¨æ•°æ®ï¼Œæˆ‘å¸®ä½ æ‰”å‡ºå»â€

```

# 4. å¦‚ä½•ç»™ã€å·²ç»å­˜åœ¨çš„å®¹å™¨ã€‘æ·»åŠ ä»£ç†ï¼Ÿ

> è¿™ä¸ªç‚¹å¾ˆé‡è¦ï¼š  
> **Docker å®¹å™¨ä¸€æ—¦åˆ›å»ºï¼Œç¯å¢ƒå˜é‡æ˜¯ä¸èƒ½åŠ¨æ€æ”¹çš„**

æ‰€ä»¥ç­”æ¡ˆæ˜¯ï¼š

> âŒ ä¸èƒ½ç›´æ¥â€œç»™è¿è¡Œä¸­çš„å®¹å™¨åŠ ä»£ç†â€  
> âœ… å¿…é¡» **é‡å»ºå®¹å™¨**


## 4.1 æ–¹æ³•ä¸€ï¼ˆæ¨èï¼‰ï¼šæ”¹ docker-composeï¼Œç„¶åé‡å»º

### 1ï¸âƒ£ ä¿®æ”¹ compose æ–‡ä»¶
```bash
services:
  app:
    image: xxx
    environment:
      - HTTP_PROXY=http://å®¿ä¸»æœºIP:7890
      - HTTPS_PROXY=http://å®¿ä¸»æœºIP:7890

```


### 2ï¸âƒ£ é‡å»ºå®¹å™¨ï¼ˆâš  ä¸æ˜¯ restartï¼‰

```
docker compose down
docker compose up -d

```

### 3ï¸âƒ£ éªŒè¯

```
docker exec -it app sh curl https://github.com
```

---

## 4.2 æ–¹æ³•äºŒï¼šåªå¯¹ã€Œæ‹‰é•œåƒã€ç”Ÿæ•ˆï¼ˆå¾ˆå¤šäººä¼šææ··ï¼‰

å¦‚æœä½ æ˜¯ï¼š

> docker pull å¤±è´¥

é‚£ä½ éœ€è¦çš„æ˜¯ **Docker å®ˆæŠ¤è¿›ç¨‹ä»£ç†**ï¼Œä¸æ˜¯å®¹å™¨ä»£ç†ã€‚

### é…ç½® Docker daemon ä»£ç†
```bash
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo nano /etc/systemd/system/docker.service.d/proxy.conf
```

å†…å®¹ï¼š
```bash
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:7890"
Environment="HTTPS_PROXY=http://127.0.0.1:7890"
```

ç„¶åï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl restart docker
```

âš  è¿™ä¸ª**åªå½±å“ docker pull / build**

---