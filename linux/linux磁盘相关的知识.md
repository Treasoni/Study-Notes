---
tags: [linux]
---

# Linux ç£ç›˜ç®¡ç†

> [!info] æ¦‚è¿°
> **Linux ç£ç›˜ç®¡ç†å°±åƒæ•´ç†ä¸€ä¸ªå¤§ä»“åº“** - æŠŠä¸åŒå¤§å°çš„è´§æŸœï¼ˆç¡¬ç›˜ï¼‰åˆ†åŒºã€æ ‡è®°ï¼ˆæ ¼å¼åŒ–ï¼‰ï¼Œç„¶åæ”¾åˆ°æŒ‡å®šä½ç½®ï¼ˆæŒ‚è½½ï¼‰ï¼Œæ–¹ä¾¿å­˜å–è´§ç‰©ï¼ˆæ–‡ä»¶ï¼‰ã€‚

## æ ¸å¿ƒæ¦‚å¿µ ğŸ’¡

### ç£ç›˜å‘½åè§„åˆ™

**ä¼ ç»Ÿç¡¬ç›˜**ï¼š
- `/dev/sda` - ç¬¬ä¸€å— SATA/SCSI/SAS ç¡¬ç›˜
- `/dev/sdb` - ç¬¬äºŒå—ç¡¬ç›˜
- `/dev/sda1` - ç¬¬ä¸€å—ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº

**NVMe SSD**ï¼š
- `/dev/nvme0n1` - ç¬¬ä¸€å— NVMe ç¡¬ç›˜
- `/dev/nvme0n1p1` - ç¬¬ä¸€å— NVMe ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº
- `/dev/nvme1n1` - ç¬¬äºŒå— NVMe ç¡¬ç›˜

**å…¶ä»–è®¾å¤‡**ï¼š
- `/dev/mmcblk0` - eMMC åµŒå…¥å¼å­˜å‚¨
- `/dev/sr0` - å…‰é©±è®¾å¤‡

### åˆ†åŒºè¡¨ç±»å‹

| ç±»å‹ | MBRï¼ˆè€å¼ï¼‰ | GPTï¼ˆæ–°å¼ï¼Œæ¨èï¼‰ |
|------|-------------|------------------|
| ç£ç›˜å®¹é‡ | æœ€å¤§ 2TB | ç†è®º 8ZB |
| åˆ†åŒºæ•°é‡ | æœ€å¤š 4 ä¸ªä¸»åˆ†åŒº | é»˜è®¤ 128 ä¸ª |
| å¼•å¯¼æ–¹å¼ | BIOS | UEFI |
| å¤‡ä»½åˆ†åŒºè¡¨ | æ—  | æœ‰ï¼ˆä¸»è¡¨+å¤‡ä»½è¡¨ï¼‰|

### æ–‡ä»¶ç³»ç»Ÿç±»å‹

| ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **ext4** | é€šç”¨ã€ç¨³å®šï¼ŒLinux é»˜è®¤ | æ¡Œé¢ã€æœåŠ¡å™¨ |
| **xfs** | æ€§èƒ½å¥½ï¼Œé€‚åˆå¤§æ–‡ä»¶ | æœåŠ¡å™¨ã€æ•°æ®åº“ |
| **btrfs** | æ”¯æŒå¿«ç…§ã€å‹ç¼© | é«˜çº§åŠŸèƒ½éœ€æ±‚ |
| **FAT32** | è·¨å¹³å°å…¼å®¹ | U ç›˜ã€ç§»åŠ¨ç¡¬ç›˜ |
| **NTFS** | Windows åŸç”Ÿ | ä¸ Windows å…±ç”¨ |

### æŒ‚è½½ï¼ˆMountï¼‰

æŒ‚è½½å°±æ˜¯æŠŠåˆ†åŒº"æ¥"åˆ°ç›®å½•æ ‘çš„æŸä¸ªèŠ‚ç‚¹ä¸Šã€‚ä¾‹å¦‚ï¼š
```bash
sudo mount /dev/sdb1 /mnt/data
```

æ‰§è¡Œåï¼Œè®¿é—® `/mnt/data/file.txt` å®é™…ä¸Šæ˜¯åœ¨è®¿é—® `/dev/sdb1` è¿™ä¸ªåˆ†åŒºã€‚

## æ“ä½œæ­¥éª¤

### åœºæ™¯ä¸€ï¼šæ·»åŠ æ–°ç¡¬ç›˜

#### æµç¨‹æ€»è§ˆ
```
æŸ¥çœ‹ç¡¬ç›˜ â†’ åˆ†åŒº â†’ æ ¼å¼åŒ– â†’ æŒ‚è½½ â†’ è®¾ç½®è‡ªåŠ¨æŒ‚è½½
```

#### 1. æŸ¥çœ‹ç¡¬ç›˜
```bash
lsblk
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
sda    8:0  0 100G 0 disk
â”œâ”€sda1 8:1  0 50G  0 part /
â””â”€sda2 8:2  0 50G  0 part /home
sdb    8:16 0 500G 0 disk    â† æ–°ç¡¬ç›˜
```

#### 2. åˆ†åŒº
```bash
sudo fdisk /dev/sdb
```

äº¤äº’å¼æ“ä½œï¼š
```
m   # å¸®åŠ©
p   # æŸ¥çœ‹åˆ†åŒºè¡¨
n   # æ–°å»ºåˆ†åŒº
d   # åˆ é™¤åˆ†åŒº
w   # å†™å…¥ä¿å­˜
q   # é€€å‡ºä¸ä¿å­˜
```

åˆ›å»ºåˆ†åŒºç¤ºä¾‹ï¼š
```
n   # æ–°å»ºåˆ†åŒº
p   # ä¸»åˆ†åŒº
å›è½¦  # ä½¿ç”¨é»˜è®¤åˆ†åŒºå·
å›è½¦  # é»˜è®¤èµ·å§‹ä½ç½®
+100G  # åˆ†åŒºå¤§å° 100G
w   # å†™å…¥
```

åˆ·æ–°åˆ†åŒºè¡¨ï¼š
```bash
sudo partprobe
```

#### 3. æ ¼å¼åŒ–
```bash
# ext4ï¼ˆæ¨èï¼‰
sudo mkfs.ext4 /dev/sdb1

# xfs
sudo mkfs.xfs /dev/sdb1
```

#### 4. æŒ‚è½½
```bash
sudo mkdir /mnt/data
sudo mount /dev/sdb1 /mnt/data
```

éªŒè¯ï¼š
```bash
df -h
```

#### 5. è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½

è·å– UUIDï¼š
```bash
sudo blkid /dev/sdb1
```

ç¼–è¾‘ `/etc/fstab`ï¼š
```bash
sudo nano /etc/fstab
```

æ·»åŠ ä¸€è¡Œï¼š
```
UUID=ä½ çš„UUID /mnt/data ext4 defaults 0 2
```

æµ‹è¯•é…ç½®ï¼š
```bash
sudo mount -a
```

### åœºæ™¯äºŒï¼šæ‰©å±•ç°æœ‰åˆ†åŒº

> [!warning] é‡è¦æç¤º
> æ‰©å±•åˆ†åŒºæ¶‰åŠåˆ é™¤åˆ†åŒºè¡¨ï¼Œæ“ä½œä¸å½“ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å»ºè®®å…ˆå¤‡ä»½é‡è¦æ•°æ®ï¼

#### 1. æŸ¥çœ‹å½“å‰åˆ†åŒº
```bash
lsblk
sudo fdisk -l
```

#### 2. åˆ é™¤å¹¶é‡å»ºåˆ†åŒº

```bash
sudo fdisk /dev/sda
```

æ“ä½œæ­¥éª¤ï¼š
```
d   # åˆ é™¤åˆ†åŒº
2   # é€‰æ‹©è¦åˆ é™¤çš„åˆ†åŒºå·ï¼ˆå¦‚ sda2ï¼‰
n   # æ–°å»ºåˆ†åŒº
p   # ä¸»åˆ†åŒº
2   # åˆ†åŒºå·
<èµ·å§‹æ‰‡åŒºï¼šå’ŒåŸæ¥ä¸€æ¨¡ä¸€æ ·>
<ç›´æ¥å›è½¦ï¼Œç”¨æ»¡å‰©ä½™ç©ºé—´>
```

å¦‚æœæç¤º "Do you want to remove the signature?"ï¼Œé€‰æ‹© **N**ï¼ˆä¿ç•™ LVM ç­¾åï¼‰ã€‚

```
w   # å†™å…¥ä¿å­˜
```

åˆ·æ–°åˆ†åŒºè¡¨ï¼š
```bash
sudo partprobe
```

#### 3. æ‰©å±• LVMï¼ˆå¦‚æœä½¿ç”¨ LVMï¼‰

```bash
# æ‰©å±•ç‰©ç†å·
sudo pvresize /dev/sda2

# æ‰©å±•é€»è¾‘å·
sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv

# æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆext4ï¼‰
sudo resize2fs /dev/ubuntu-vg/ubuntu-lv
```

#### 4. éªŒè¯
```bash
df -h
```

### åœºæ™¯ä¸‰ï¼šSwap äº¤æ¢åˆ†åŒº

#### åˆ›å»º Swap æ–‡ä»¶ï¼ˆæ¨èï¼‰
```bash
# åˆ›å»º 4GB æ–‡ä»¶
sudo fallocate -l 4G /swapfile

# è®¾ç½®æƒé™
sudo chmod 600 /swapfile

# æ ¼å¼åŒ–ä¸º swap
sudo mkswap /swapfile

# å¯ç”¨
sudo swapon /swapfile
```

#### è®¾ç½®å¼€æœºè‡ªåŠ¨å¯ç”¨
```bash
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

#### æŸ¥çœ‹ Swap ä½¿ç”¨æƒ…å†µ
```bash
free -h
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
              total        used        free      shared  buff/cache   available
Mem:           15Gi        3.1Gi        10.8Gi       200Mi       2.2Gi       11Gi
Swap:          2Gi          0Mi         2Gi
```

## æ³¨æ„äº‹é¡¹ âš ï¸

### å¸¸è§é”™è¯¯

**å¿˜è®°åˆ·æ–°åˆ†åŒºè¡¨**ï¼š
```bash
# åˆ†åŒºåç›´æ¥æ ¼å¼åŒ–æŠ¥é”™
sudo mkfs.ext4 /dev/sdb1
# Could not access /dev/sdb1

# è§£å†³ï¼šåˆ·æ–°åˆ†åŒºè¡¨
sudo partprobe
```

**fstab é…ç½®é”™è¯¯å¯¼è‡´æ— æ³•å¼€æœº**ï¼š
```bash
# æµ‹è¯•é…ç½®
sudo mount -a

# å¦‚æœæŠ¥é”™ï¼Œä¿®å¤ fstab åå†æµ‹è¯•
```

**UUID å˜åŒ–å¯¼è‡´æŒ‚è½½å¤±è´¥**ï¼š
```bash
# é‡æ–°è·å– UUID
sudo blkid /dev/sdb1

# æ›´æ–° fstab ä¸­çš„ UUID
```

### å…³é”®é…ç½®ç‚¹

**/etc/fstab æ ¼å¼**ï¼š
```
<è®¾å¤‡>  <æŒ‚è½½ç‚¹>  <æ–‡ä»¶ç³»ç»Ÿ>  <æŒ‚è½½é€‰é¡¹>  <dump>  <fsck>
```

**å¸¸ç”¨æŒ‚è½½é€‰é¡¹**ï¼š
- `defaults` - ç­‰åŒäº `rw,suid,dev,exec,auto,nouser,async`
- `noatime` - ä¸æ›´æ–°è®¿é—®æ—¶é—´ï¼ˆæé«˜æ€§èƒ½ï¼‰
- `ro` - åªè¯»
- `rw` - å¯è¯»å†™

**Swap å¤§å°æ¨è**ï¼š
| å†…å­˜å¤§å° | æ¨è Swap å¤§å° |
|----------|---------------|
| â‰¤ 2GB | å†…å­˜çš„ 2 å€ |
| 4GB ~ 8GB | ä¸å†…å­˜ç›¸åŒ |
| â‰¥ 16GB | 2GB ~ 4GB |
| éœ€è¦ä¼‘çœ  | â‰¥ å†…å­˜å¤§å° |

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### æŸ¥çœ‹å‘½ä»¤
| å‘½ä»¤ | ä½œç”¨ |
|------|------|
| `lsblk` | æŸ¥çœ‹ç£ç›˜å’Œåˆ†åŒºç»“æ„ |
| `df -h` | æŸ¥çœ‹å·²æŒ‚è½½åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µ |
| `free -h` | æŸ¥çœ‹å†…å­˜å’Œ Swap ä½¿ç”¨æƒ…å†µ |
| `blkid` | æŸ¥çœ‹åˆ†åŒº UUID å’Œç±»å‹ |
| `du -sh ç›®å½•` | æŸ¥çœ‹ç›®å½•å ç”¨ç©ºé—´ |

### åˆ†åŒºå‘½ä»¤
| å‘½ä»¤ | ä½œç”¨ |
|------|------|
| `fdisk /dev/sda` | äº¤äº’å¼åˆ†åŒºï¼ˆMBR/GPTï¼‰|
| `gdisk /dev/sda` | äº¤äº’å¼åˆ†åŒºï¼ˆGPT ä¸“ç”¨ï¼‰|
| `partprobe` | åˆ·æ–°åˆ†åŒºè¡¨ |

### æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤
| å‘½ä»¤ | ä½œç”¨ |
|------|------|
| `mkfs.ext4 /dev/sdb1` | æ ¼å¼åŒ–ä¸º ext4 |
| `mkfs.xfs /dev/sdb1` | æ ¼å¼åŒ–ä¸º xfs |
| `resize2fs /dev/sdb1` | æ‰©å±•/ç¼©å° ext4 |
| `xfs_growfs /` | æ‰©å±• xfsï¼ˆåªèƒ½æ‰©ï¼‰|

### æŒ‚è½½å‘½ä»¤
| å‘½ä»¤ | ä½œç”¨ |
|------|------|
| `mount /dev/sdb1 /mnt` | æŒ‚è½½åˆ†åŒº |
| `umount /mnt` | å¸è½½åˆ†åŒº |
| `mount -a` | æŒ‚è½½ /etc/fstab ä¸­çš„æ‰€æœ‰é¡¹ |

## å¸¸è§é—®é¢˜ â“

**Q: ç£ç›˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ**

A: æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š
```bash
# 1. æŸ¥çœ‹æ•´ä½“æƒ…å†µ
df -h

# 2. æ‰¾å‡ºå ç”¨ç©ºé—´æœ€å¤§çš„ç›®å½•
sudo du -h --max-depth=1 / | sort -h

# 3. æ£€æŸ¥å¸¸è§å ç”¨ä½ç½®
sudo du -sh /var/log      # æ—¥å¿—
du -sh ~/.cache           # ç¼“å­˜
sudo du -sh /var/lib/docker  # Docker
```

**Q: å¦‚ä½•å®‰å…¨åœ°å¸è½½åˆ†åŒºï¼Ÿ**

A: ç¡®ä¿æ²¡æœ‰ç¨‹åºåœ¨ä½¿ç”¨ï¼š
```bash
# æŸ¥çœ‹å“ªäº›è¿›ç¨‹åœ¨ä½¿ç”¨
sudo lsof /mnt/data

# å¸è½½
sudo umount /mnt/data

# å¦‚æœæç¤º"ç›®æ ‡å¿™"ï¼Œä½¿ç”¨å»¶è¿Ÿå¸è½½
sudo umount -l /mnt/data
```

**Q: NVMe ç¡¬ç›˜å’Œ SATA ç¡¬ç›˜æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

A: ä¸»è¦åŒºåˆ«ï¼š
- **æ€§èƒ½**ï¼šNVMe ä½¿ç”¨ PCIe é€šé“ï¼Œé€Ÿåº¦è¿œè¶… SATA
- **å‘½å**ï¼šNVMe ä½¿ç”¨ `/dev/nvme0n1`ï¼ŒSATA ä½¿ç”¨ `/dev/sda`
- **åˆ†åŒº**ï¼šNVMe åˆ†åŒºå¸¦ `p`ï¼ˆå¦‚ `nvme0n1p1`ï¼‰ï¼ŒSATA ç›´æ¥åŠ æ•°å­—ï¼ˆå¦‚ `sda1`ï¼‰

**Q: å¦‚ä½•æ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€ï¼Ÿ**

A: ä½¿ç”¨ `smartctl` å·¥å…·ï¼š
```bash
# å®‰è£…
sudo apt install smartmontools

# æ£€æŸ¥ç£ç›˜å¥åº·
sudo smartctl -H /dev/sda

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
sudo smartctl -a /dev/sda
```

**Q: å¦‚ä½•ä¿®å¤æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ï¼Ÿ**

A: ä½¿ç”¨ `fsck` å·¥å…·ï¼š
```bash
# å¸è½½åˆ†åŒº
sudo umount /dev/sdb1

# æ£€æŸ¥å¹¶ä¿®å¤
sudo fsck /dev/sdb1

# é‡æ–°æŒ‚è½½
sudo mount /dev/sdb1 /mnt
```

## ç›¸å…³æ–‡æ¡£
[[linuxçš„LVMç®¡ç†]] | [[linuxçš„æ–‡ä»¶æƒé™]]
